# üß™ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ä–µ–∞–ª—å–Ω—ã–π flow)

## ‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:

1. **–û—Ç–ø—Ä–∞–≤–∫–∞ SMS** ‚Üí –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Ä–µ–∞–ª—å–Ω–æ–µ SMS –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
2. **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è OTP** ‚Üí –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å—Å—è
3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** ‚Üí –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. **–°–æ–∑–¥–∞–Ω–∏–µ –≤ iiko** ‚Üí –ù–æ–≤—ã–π –≥–æ—Å—Ç—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ iikoLoyalty
5. **–ë–∞–ª–∞–Ω—Å = 0** ‚Üí –£ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –±–∞–ª–∞–Ω—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0

---

## üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º:

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ backend:

```powershell
cd D:\27\loyalty-backend
node -e "require('dotenv').config(); console.log('ESKIZ_EMAIL:', process.env.ESKIZ_EMAIL ? 'SET' : 'NOT SET'); console.log('IIKO_API_LOGIN:', process.env.IIKO_API_LOGIN ? 'SET' : 'NOT SET'); console.log('IIKO_ORGANIZATION_ID:', process.env.IIKO_ORGANIZATION_ID ? 'SET' : 'NOT SET');"
```

**–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:**
- ‚úÖ `ESKIZ_EMAIL` - –≤–∞—à email –¥–ª—è ESKIZ
- ‚úÖ `ESKIZ_PASSWORD` - –≤–∞—à –ø–∞—Ä–æ–ª—å ESKIZ
- ‚úÖ `ESKIZ_SENDER_NAME` - –∏–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ ESKIZ)
- ‚úÖ `IIKO_API_LOGIN` - –≤–∞—à iiko API login
- ‚úÖ `IIKO_ORGANIZATION_ID` - ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ iiko

### 2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã:

```powershell
# Backend (–ø–æ—Ä—Ç 3001)
netstat -ano | findstr :3001

# Frontend (–ø–æ—Ä—Ç 4028)
netstat -ano | findstr :4028
```

---

## üß™ –ü–û–®–ê–ì–û–í–´–ô –¢–ï–°–¢:

### –®–ê–ì 1: –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:4028/signup`
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console –∏ Network tabs

### –®–ê–ì 2: –í–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞

1. –í–≤–µ–¥–∏—Ç–µ **–†–ï–ê–õ–¨–ù–´–ô** –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–≤–∞—à –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π)
   - –§–æ—Ä–º–∞—Ç: `+998 90 123 45 67`
2. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥"

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –í Network tab –≤–∏–¥–Ω–æ –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/auth/send-otp`
- ‚úÖ –ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω (Status 200)
- ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏ backend –≤–∏–¥–Ω–æ: "ESKIZ SMS send..."
- ‚úÖ **–î–û–õ–ñ–ù–û –ü–†–ò–ô–¢–ò SMS** –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —Å –∫–æ–¥–æ–º

**–ï—Å–ª–∏ SMS –Ω–µ –ø—Ä–∏—à–ª–æ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ESKIZ credentials –≤ `.env`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å ESKIZ –∞–∫–∫–∞—É–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend –Ω–∞ –æ—à–∏–±–∫–∏

### –®–ê–ì 3: –í–≤–µ—Å—Ç–∏ OTP –∫–æ–¥

1. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS
2. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –í Network tab –≤–∏–¥–Ω–æ –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/auth/verify-otp`
- ‚úÖ –ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω (Status 200)
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —à–∞–≥ 3 (–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

### –®–ê–ì 4: –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

1. –í–≤–µ–¥–∏—Ç–µ:
   - **–ò–º—è**: –Ω–∞–ø—Ä–∏–º–µ—Ä, "–¢–µ—Å—Ç"
   - **–§–∞–º–∏–ª–∏—è**: –Ω–∞–ø—Ä–∏–º–µ—Ä, "–¢–µ—Å—Ç–æ–≤"
   - **–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è**: –≤—ã–±–µ—Ä–∏—Ç–µ –ª—é–±—É—é –¥–∞—Ç—É
2. –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –í Network tab –≤–∏–¥–Ω–æ –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/customers/register`
- ‚úÖ –ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω (Status 200)
- ‚úÖ –í –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å `customer.id` –∏ `customer.iikoCustomerId`
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/home-dashboard`

### –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```powershell
cd D:\27\loyalty-backend
node -e "require('dotenv').config(); const { Pool } = require('pg'); const pool = new Pool({ connectionString: process.env.DATABASE_URL, ssl: { rejectUnauthorized: false } }); pool.query('SELECT * FROM customers ORDER BY created_at DESC LIMIT 1').then(r => { console.log('–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–ª–∏–µ–Ω—Ç:', JSON.stringify(r.rows[0], null, 2)); pool.end(); });"
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ `customers`
- ‚úÖ –ï—Å—Ç—å `iiko_customer_id`
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –≤–≤–µ–¥–µ–Ω–Ω—ã–º

### –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≤ iiko

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ iiko Dashboard**
1. –û—Ç–∫—Ä–æ–π—Ç–µ iiko Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ì–æ—Å—Ç–∏" –∏–ª–∏ "–ö–ª–∏–µ–Ω—Ç—ã"
3. –ù–∞–π–¥–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
   - ‚úÖ –ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
   - ‚úÖ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ API**
```powershell
cd D:\27\loyalty-backend
node -e "require('dotenv').config(); const iiko = require('./src/services/iikoLoyaltyService'); iiko.getCustomerInfo('998901234567').then(r => console.log('iiko Customer:', JSON.stringify(r, null, 2))).catch(e => console.error('Error:', e.message));"
```

### –®–ê–ì 7: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0)

**–ß–µ—Ä–µ–∑ API:**
```powershell
cd D:\27\loyalty-backend
node -e "require('dotenv').config(); const iiko = require('./src/services/iikoLoyaltyService'); const customer = await iiko.getCustomerInfo('998901234567'); console.log('Balance:', customer.balance || 0);"
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ frontend:**
1. –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ `/home-dashboard`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
3. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å **0** –∏–ª–∏ **0.00**

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ DevTools:

### Network Tab - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã:

1. **POST `/api/auth/send-otp`**
   - Status: 200
   - Response: `{"success": true, "message": "OTP –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω..."}`

2. **POST `/api/auth/verify-otp`**
   - Status: 200
   - Response: `{"success": true, "token": "..."}`

3. **POST `/api/customers/register`**
   - Status: 200
   - Response: `{"success": true, "customer": {...}}`
   - –í `customer` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
     - `id` - UUID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
     - `iikoCustomerId` - ID –∏–∑ iiko

### Console Tab - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —É—Å–ø–µ—à–Ω—ã
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage:
  - `customerId`
  - `customerPhone`
  - `customerName`
  - `isNewCustomer`

---

## üêõ Troubleshooting:

### SMS –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ESKIZ credentials:**
   ```powershell
   cd D:\27\loyalty-backend
   node -e "require('dotenv').config(); const eskiz = require('./src/services/sms/eskizService'); eskiz.getBalance().then(r => console.log('ESKIZ Balance:', r)).catch(e => console.error('Error:', e));"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend:**
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –æ—Ç ESKIZ
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ `998XXXXXXXXX`
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–µ–Ω

### –ö–ª–∏–µ–Ω—Ç –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ iiko:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ iiko credentials:**
   ```powershell
   cd D:\27\loyalty-backend
   node -e "require('dotenv').config(); console.log('IIKO_API_LOGIN:', process.env.IIKO_API_LOGIN); console.log('IIKO_ORGANIZATION_ID:', process.env.IIKO_ORGANIZATION_ID);"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend:**
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –æ—Ç iiko API
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:**
   - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤
   - –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD

### –ë–∞–ª–∞–Ω—Å –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ iiko**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ endpoint –±–∞–ª–∞–Ω—Å–∞:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ iiko API
   - –ù–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –≤—Å–µ–≥–¥–∞ –∏–º–µ—é—Ç –±–∞–ª–∞–Ω—Å 0

---

## ‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Ç–µ—Å—Ç:

–ï—Å–ª–∏ –≤—Å–µ —à–∞–≥–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ:

- ‚úÖ SMS –ø—Ä–∏—à–ª–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
- ‚úÖ OTP –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
- ‚úÖ –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ iiko
- ‚úÖ –ë–∞–ª–∞–Ω—Å = 0
- ‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ dashboard

**–¢–æ–≥–¥–∞ –≤—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é!** üéâ

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞:

- [ ] SMS –ø—Ä–∏—à–ª–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä
- [ ] OTP –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª—Å—è
- [ ] –ö–ª–∏–µ–Ω—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ SQL)
- [ ] –ö–ª–∏–µ–Ω—Ç –≤ iiko (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ dashboard –∏–ª–∏ API)
- [ ] –ë–∞–ª–∞–Ω—Å = 0 (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)
- [ ] Dashboard –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- [ ] QR –∫–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

